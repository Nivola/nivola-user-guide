.. _Migrazione DBAAS:



**Best Practice**
^^^^^^^^^^^^^^^^^

Per la migrazione di database tra Farm differenti è possibile utilizzare il meccanismo di Replica.

Questo automatismo permette di effettuare una migrazione a caldo dei database, minimizzando i tempi di fermo servizio e diminuendo la possibilità di errori dovuti a operazioni di export/import manuali effettuate in fase di migrazione. L’utilizzo di questo meccanismo è vincolato al soddisfacimento di alcuni requisiti di versioni di DBMS e visibilità di rete.

La Replica è disponibile per i principali DBMS offerti dalla piattaforma Nivola.

Elenchiamo i passi necessari per effettuare la migrazione di un DBOLD, su Farm di origine, verso un DBNEW sul Cloud Nivola.

-  Per prima cosa viene creato e configurato il DBNEW sulla farm di destinazione.

-  Viene attivata la replica Active/Passive tra il DBOLD verso DBNEW. Da questo momento in poi tutte le operazioni e modifiche ai dati effettuate su DBOLD verranno sincronizzate sul DBNEW.

-  Si concorda la data e ora di migrazione effettiva

-  Nella data pianificata per l’intervento si disattiva in scrittura il DBOLD. Viene attivato in scrittura il DBNEW (che in questo momento avrà contenuti consistenti conl DBOLD) e possono essere apportate le modifiche di configurazione alla componente applicative che accedono al Db in modo da farla puntare a DBNEW.

-  Se lo si desidera è ancora possibile configurare temporaneamente la replica active/passive tra DBNEW e DBOLD, Questo permette, in caso di rollback, di avere una situazione aggiornata e consistente su DBOLD



**Import**
^^^^^^^^^^

**Import da server openstack**

Creazione provider instance:

.. code-block:: bash


    $ beehive res-provider instance-import dbs-emood2-tst-bck-001m-server01 0ef13cc2-1d47-45ee-ae9d-2d06ccb7839a passw0rd 46ea8662-94a1-496a-9a64-73342d4e2c06 opstkcsi-podto2


Registrazione provider instance nel modulo ssh per abilitare la connessione utente via ssh:

.. code-block:: bash


    $ beehive res-provider instance-manage 864f8b9d-522a-4328-8e4b-564873418018 opstkcsi-podto2


Disabilitazione calcolo quote e metriche della provider instance:

.. code-block:: bash


    $ beehive res entities disable-quotas 864f8b9d-522a-4328-8e4b-564873418018


Creazione provider sql stack v2:

.. code-block:: bash


    $ beehive res-provider stack-sql-import dbs-emood2-tst-bck-001m dbs-emood2-tst-bck-001m-server01 mysql 5.7.23 '<pwd dbms>'


Creazione del servizio utente nell’account:

.. code-block:: bash


    $ beehive bu service-insts import-from-resource dbs-emood2-tst-bck-001m emood2-preprod DatabaseInstance DatabaseService 04f4e790-9529-4e9c-899a-4036113744b5
